using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Text;

namespace ACESim
{

    public static class NormalDistributionPDF
    {
        public static double GetStandardNormalDistributionPDFApproximate(double numStandardDeviationsFromMean)
        {
            // faster than return alglib.normaldistr.normaldistribution(Math.Abs(numStandardDeviationsFromMean));

            int entryNum = (int) Math.Abs(numStandardDeviationsFromMean * inverseOfIncrementSize);
            if (entryNum > numStoredEntries - 1)
                entryNum = numStoredEntries - 1;
            return standardNormalDistribution[entryNum];
        }

        public static double GetStandardNormalDistributionPDFExact(double numStandardDeviationsFromMean)
        {
            const double sqrt2pi = 2.50662827463100;
            return Math.Exp(-Math.Pow(numStandardDeviationsFromMean, 2) / 2) / sqrt2pi;
        }

        // This seems to indicate that approximation is about 9 times faster
        public static void TestSpeed()
        {
            double test = 0;

            Stopwatch s = new Stopwatch();
            s.Start();
            for (int i = 0; i < 100000; i++)
                for (double stdev = 0.001; stdev <= 6.0; stdev += 0.01)
                    test = NormalDistributionPDF.GetStandardNormalDistributionPDFApproximate(stdev);
            s.Stop();

            Stopwatch s2 = new Stopwatch();
            s2.Start();
            for (int i = 0; i < 100000; i++)
                for (double stdev = 0.001; stdev <= 6.0; stdev += 0.01)
                    test = NormalDistributionPDF.GetStandardNormalDistributionPDFExact(stdev);
            s2.Stop();

            Debug.WriteLine(s.ElapsedMilliseconds + " " + s2.ElapsedMilliseconds);
        }

        static int numStoredEntries = 601;
        static double inverseOfIncrementSize = 100.0;
        // increments of 0.01 standard deviation starting with zero. There are 600 entries altogether.
        // the commented out version was created in excel with formula =NORM.S.DIST(B1,FALSE) and standard deviation increments beginning in B1
        // The accuracy of Excel was confirmed by using wolfram alpha and testing, e.g., e^((-(3.4)^2)/2))/sqrt(2pi) (i.e., the formal for the standard normal pdf)
        // The revised version was created with the formula 1.0 - alglib.normaldistr.normaldistribution(distance in standard deviations) starting with 0
        public static double[] standardNormalDistribution = { 0.39894228040143300, 0.39892233378608200, 0.39886249992366600, 0.39876279676210000, 0.39862325420460500, 0.39844391409476400, 0.39822483019560700, 0.39796606816275100, 0.39766770551160900, 0.39732983157868800, 0.39695254747701200, 0.39653596604568600, 0.39608021179365600, 0.39558542083768700, 0.39505174083461100, 0.39447933090788900, 0.39386836156854100, 0.39321901463049700, 0.39253148312042900, 0.39180597118212100, 0.39104269397545600, 0.39024187757007400, 0.38940375883379000, 0.38852858531583600, 0.38761661512501400, 0.38666811680284900, 0.38568336919181600, 0.38466266129874300, 0.38360629215347900, 0.38251457066292400, 0.38138781546052400, 0.38022635475132500, 0.37903052615270200, 0.37780067653086500, 0.37653716183325400, 0.37524034691693800, 0.37391060537312800, 0.37254831934793300, 0.37115387935946600, 0.36972768411143200, 0.36827014030332300, 0.36678166243733600, 0.36526267262215400, 0.36371360037371300, 0.36213488241309200, 0.36052696246164800, 0.35889029103354500, 0.35722532522580100, 0.35553252850599700, 0.35381237049778000, 0.35206532676430000, 0.35029187858972600, 0.34849251275897400, 0.34666772133579200, 0.34481800143933300, 0.34294385501938400, 0.34104578863035300, 0.33912431320419200, 0.33717994382238100, 0.33521319948710600, 0.33322460289180000, 0.33121468019115300, 0.32918396077076500, 0.32713297701655400, 0.32506226408408200, 0.32297235966791400, 0.32086380377117300, 0.31873713847540200, 0.31659290771089300, 0.31443165702759700, 0.31225393336676100, 0.31006028483341600, 0.30785126046985300, 0.30562741003021000, 0.30338928375630000, 0.30113743215480400, 0.29887240577595300, 0.29659475499381600, 0.29430502978832500, 0.29200377952914100, 0.28969155276148300, 0.28736889699402800, 0.28503635848900700, 0.28269448205458000, 0.28034381083962100, 0.27798488613099600, 0.27561824715345700, 0.27324443087221600, 0.27086397179833800, 0.26847740179700200, 0.26608524989875500, 0.26368804211381800, 0.26128630124955300, 0.25888054673114900, 0.25647129442562000, 0.25405905646918900, 0.25164434109811700, 0.24922765248306600, 0.24680949056704300, 0.24439035090700000, 0.24197072451914300, 0.23955109772801300, 0.23713195201938000, 0.23471376389701200, 0.23229700474336600, 0.22988214068423300, 0.22746963245738600, 0.22505993528527000, 0.22265349875176100, 0.22025076668303300, 0.21785217703255100, 0.21545816177022000, 0.21306914677571800, 0.21068555173601500, 0.20830779004710800, 0.20593626871997500, 0.20357138829075900, 0.20121354273519700, 0.19886311938727600, 0.19652049886213700, 0.19418605498321300, 0.19186015471359900, 0.18954315809164000, 0.18723541817073000, 0.18493728096330500, 0.18264908538902200, 0.18037116322708000, 0.17810383907269400, 0.17584743029766200, 0.17360224701503300, 0.17136859204780700, 0.16914676090167200, 0.16693704174171400, 0.16473971537307700, 0.16255505522553400, 0.16038332734192000, 0.15822479037038300, 0.15607969556042100, 0.15394828676263400, 0.15183080043216200, 0.14972746563574500, 0.14763850406235600, 0.14556413003734800, 0.14350455054006200, 0.14145996522483900, 0.13943056644536000, 0.13741653928228200, 0.13541806157407100, 0.13343530395100200, 0.13146842987223100, 0.12951759566589200, 0.12758295057214200, 0.12566463678908800, 0.12376278952152300, 0.12187753703240200, 0.12000900069698600, 0.11815729505958200, 0.11632252789280700, 0.11450480025929200, 0.11270420657577100, 0.11092083467945600, 0.10915476589664700, 0.10740607511348400, 0.10567483084876400, 0.10396109532876400, 0.10226492456397800, 0.10058636842769100, 0.09892547073632370, 0.09728226933146750, 0.09565679616352400, 0.09404907737688690, 0.09245913339658070, 0.09088697901628290, 0.08933262348765500, 0.08779607061090560, 0.08627731882651150, 0.08477636130802220, 0.08329318605587450, 0.08182777599214280, 0.08038010905615420, 0.07895015830089410, 0.07753789199013400, 0.07614327369620730, 0.07476626239836760, 0.07340681258165690, 0.07206487433621800, 0.07074039345698340, 0.06943331154367420, 0.06814356610104460, 0.06687109063930720, 0.06561581477467660, 0.06437766432996940, 0.06315656143519870, 0.06195242462810520, 0.06076516895456480, 0.05959470606881610, 0.05844094433345150, 0.05730378891911710, 0.05618314190386800, 0.05507890237212580, 0.05399096651318810, 0.05291922771924030, 0.05186357668282060, 0.05082390149369120, 0.04980008773507080, 0.04879201857918280, 0.04779957488207700, 0.04682263527768320, 0.04586107627105490, 0.04491477233076710, 0.04398359598042720, 0.04306741788926570, 0.04216610696177030, 0.04127953042633040, 0.04040755392286030, 0.03955004158937020, 0.03870685614745560, 0.03787785898667750, 0.03706291024780650, 0.03626186890490620, 0.03547459284623140, 0.03470093895391880, 0.03394076318244920, 0.03319392063586110, 0.03246026564369740, 0.03173965183566740, 0.03103193221500830, 0.03033695923053160, 0.02965458484734130, 0.02898466061620940, 0.02832703774160120, 0.02768156714833660, 0.02704809954688180, 0.02642648549726170, 0.02581657547158770, 0.02521821991519440, 0.02463126930638250, 0.02405557421476300, 0.02349098535820140, 0.02293735365836070, 0.02239453029484290, 0.02186236675792940, 0.02134071489992280, 0.02082942698509220, 0.02032835573822580, 0.01983735439179530, 0.01935627673173700, 0.01888497714185620, 0.01842331064686200, 0.01797113295403960, 0.01752830049356850, 0.01709467045749700, 0.01667010083738110, 0.01625445046060050, 0.01584757902536080, 0.01544934713439520, 0.01505961632737740, 0.01467824911206000, 0.01430510899414970, 0.01394006050593580, 0.01358296923368560, 0.01323370184382140, 0.01289212610789530, 0.01255811092637820, 0.01223152635127800, 0.01191224360760520, 0.01160013511370260, 0.01129507450045610, 0.01099693662940560, 0.01070559760977220, 0.01042093481442260, 0.01014282689478710, 0.00987115379475113, 0.00960579676353959, 0.00934663836761228, 0.00909356250159105, 0.00884645439823723, 0.00860520063749967, 0.00836968915465303, 0.00813980924754602, 0.00791545158297997, 0.00769650820223732, 0.00748287252578056, 0.00727443935714122, 0.00707110488601945, 0.00687276669061397, 0.00667932373920262, 0.00649067639099336, 0.00630672639626593, 0.00612737689582369, 0.00595253241977585, 0.00578209888566947, 0.00561598359599097, 0.00545409523505655, 0.00529634386531102, 0.00514264092305394, 0.00499289921361238, 0.00484703290597894, 0.00470495752693398, 0.00456658995467014, 0.00443184841193801, 0.00430065245873045, 0.00417292298452396, 0.00404858220009443, 0.00392755362892478, 0.00380976209822181, 0.00369513372955903, 0.00358359592916236, 0.00347507737785494, 0.00336950802067748, 0.00326681905619992, 0.00316694292554008, 0.00306981330110474, 0.00297536507506825, 0.00288353434760344, 0.00279425841487945, 0.00270747575684070, 0.00262312602478102, 0.00254115002872652, 0.00246148972464070, 0.00238408820146484, 0.00230888966800650, 0.00223583943968854, 0.00216488392517106, 0.00209597061285794, 0.00202904805729977, 0.00196406586550438, 0.00190097468316608, 0.00183972618082428, 0.00178027303996188, 0.00172256893905368, 0.00166656853957458, 0.00161222747197712, 0.00155950232164769, 0.00150835061485031, 0.00145873080466675, 0.00141060225694138, 0.00136392523623890, 0.00131866089182274, 0.00127477124366183, 0.00123221916847302, 0.00119096838580612, 0.00115098344417848, 0.00111222970726556, 0.00107467334015374, 0.00103828129566141, 0.00100302130073424, 0.00096886184291985, 0.00093577215692748, 0.00090372221127752, 0.00087268269504576, 0.00084262500470690, 0.00081352123108181, 0.00078534414639247, 0.00075806719142871, 0.00073166446283031, 0.00070611070048804, 0.00068138127506689, 0.00065745217565468, 0.00063429999753876, 0.00061190193011377, 0.00059023574492279, 0.00056927978383425, 0.00054901294735696, 0.00052941468309494, 0.00051046497434419, 0.00049214432883289, 0.00047443376760662, 0.00045731481405986, 0.00044076948311513, 0.00042478027055075, 0.00040933014247808, 0.00039440252496916, 0.00037998129383532, 0.00036605076455734, 0.00035259568236745, 0.00033960121248366, 0.00032705293049638, 0.00031493681290752, 0.00030323922782200, 0.00029194692579146, 0.00028104703080999, 0.00027052703146152, 0.00026037477221844, 0.00025057844489086, 0.00024112658022599, 0.00023200803965694, 0.00022321200720010, 0.00021472798150037, 0.00020654576802323, 0.00019865547139277, 0.00019104748787460, 0.00018371249800246, 0.00017664145934757, 0.00016982559942934, 0.00016325640876624, 0.00015692563406553, 0.00015082527155052, 0.00014494756042389, 0.00013928497646576, 0.00013383022576489, 0.00012857623858162, 0.00012351616334102, 0.00011864336075457, 0.00011395139806887, 0.00010943404343980, 0.00010508526043040, 0.00010089920263081, 0.00009687020839872, 0.00009299279571845, 0.00008926165717713, 0.00008567165505618, 0.00008221781653629, 0.00007889532901429, 0.00007569953553016, 0.00007262593030225, 0.00006967015436921, 0.00006682799133669, 0.00006409536322711, 0.00006146832643077, 0.00005894306775654, 0.00005651590058031, 0.00005418326108954, 0.00005194170462216, 0.00004978790209801, 0.00004771863654121, 0.00004573079969160, 0.00004382138870376, 0.00004198750293162, 0.00004022634079727, 0.00003853519674209, 0.00003691145825867, 0.00003535260300177, 0.00003385619597683, 0.00003241988680421, 0.00003104140705785, 0.00002971856767644, 0.00002844925644584, 0.00002723143555099, 0.00002606313919588, 0.00002494247129005, 0.00002386760320018, 0.00002283677156515, 0.00002184827617332, 0.00002090047790045, 0.00001999179670692, 0.00001912070969282, 0.00001828574920955, 0.00001748550102664, 0.00001671860255237, 0.00001598374110691, 0.00001527965224676, 0.00001460511813915, 0.00001395896598515, 0.00001334006649036, 0.00001274733238183, 0.00001217971697027, 0.00001163621275604, 0.00001111585007818, 0.00001061769580501, 0.00001014085206549, 0.00000968445502005, 0.00000924767367001, 0.00000882970870437, 0.00000842979138323, 0.00000804718245649, 0.00000768117111725, 0.00000733107398862, 0.00000699623414327, 0.00000667602015461, 0.00000636982517887, 0.00000607706606711, 0.00000579718250636, 0.00000552963618898, 0.00000527391000960, 0.00000502950728859, 0.00000479595102155, 0.00000457278315386, 0.00000435956387967, 0.00000415587096453, 0.00000396129909103, 0.00000377545922670, 0.00000359797801352, 0.00000342849717841, 0.00000326667296399, 0.00000311217557915, 0.00000296468866855, 0.00000282390880076, 0.00000268954497427, 0.00000256131814088, 0.00000243896074589, 0.00000232221628460, 0.00000221083887457, 0.00000210459284318, 0.00000200325232995, 0.00000190660090312, 0.00000181443119018, 0.00000172654452168, 0.00000164275058805, 0.00000156286710895, 0.00000148671951473, 0.00000141414063960, 0.00000134497042607, 0.00000127905564048, 0.00000121624959893, 0.00000115641190358, 0.00000109940818871, 0.00000104510987639, 0.00000099339394134, 0.00000094414268467, 0.00000089724351624, 0.00000085258874525, 0.00000081007537893, 0.00000076960492883, 0.00000073108322470, 0.00000069442023539, 0.00000065952989686, 0.00000062632994676, 0.00000059474176548, 0.00000056469022347, 0.00000053610353447, 0.00000050891311460, 0.00000048305344695, 0.00000045846195160, 0.00000043507886075, 0.00000041284709886, 0.00000039171216759, 0.00000037162203534, 0.00000035252703126, 0.00000033437974351, 0.00000031713492167, 0.00000030074938313, 0.00000028518192323, 0.00000027039322915, 0.00000025634579731, 0.00000024300385411, 0.00000023033328004, 0.00000021830153688, 0.00000020687759787, 0.00000019603188092, 0.00000018573618446, 0.00000017596362609, 0.00000016668858377, 0.00000015788663946, 0.00000014953452517, 0.00000014161007130, 0.00000013409215718, 0.00000012696066369, 0.00000012019642791, 0.00000011378119975, 0.00000010769760043, 0.00000010192908269, 0.00000009645989284, 0.00000009127503434, 0.00000008636023301, 0.00000008170190379, 0.00000007728711889, 0.00000007310357738, 0.00000006913957612, 0.00000006538398192, 0.00000006182620500, 0.00000005845617357, 0.00000005526430958, 0.00000005224150551, 0.00000004937910227, 0.00000004666886798, 0.00000004410297779, 0.00000004167399461, 0.00000003937485063, 0.00000003719882980, 0.00000003513955095, 0.00000003319095184, 0.00000003134727382, 0.00000002960304725, 0.00000002795307758, 0.00000002639243204, 0.00000002491642697, 0.00000002352061578, 0.00000002220077734, 0.00000002095290507, 0.00000001977319641, 0.00000001865804282, 0.00000001760402033, 0.00000001660788037, 0.00000001566654119, 0.00000001477707959, 0.00000001393672307, 0.00000001314284237, 0.00000001239294431, 0.00000001168466506, 0.00000001101576362, 0.00000001038411572, 0.00000000978770791, 0.00000000922463206, 0.00000000869307997, 0.00000000819133840, 0.00000000771778421, 0.00000000727087981, 0.00000000684916881, 0.00000000645127189, 0.00000000607588285 };
    }
}
